---
import { STORAGE_THEME_KEY, THEME_MAP } from '~/lib/theme';
---

<script is:inline define:vars={{ STORAGE_THEME_KEY, THEME_MAP }}>
  function applyTheme() {
    const theme = localStorage.getItem(STORAGE_THEME_KEY);
    if (theme) {
      document.documentElement.classList.add(theme);
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add(THEME_MAP.dark);
    }
  }

  applyTheme();
  document.addEventListener('astro:after-swap', applyTheme);
</script>
